name: Pull Request Validation

on:
  workflow_call:
    inputs:
      runner:
        description: |
          The name of the runner to use for the workflow.
        required: true
        type: string
      registry_url:
        description: |
          The URL of the Docker registry where the image will be pushed.
        required: true
        type: string
      image_name:
        type: string
        default: ${{ github.repository }}
      dockerfile:
        description: |
          The path to the Dockerfile used for building the Docker image.
        type: string
        default: "./Dockerfile"
      context:
        description: |
          The build context directory for the Docker image.
        type: string
        default: "."
      cache:
        description: |
          Enables or disables caching for Docker builds.
        type: boolean
        default: true
      cache_registry:
        description: |
          The Docker registry used to store cache layers.
        type: string
        default: "josmase/cache"
    secrets:
      registry_username:
        description: |
          The username for authentication with the Docker registry.
        required: true
      registry_password:
        description: |
          The password for authentication with the Docker registry.
        required: true

jobs:
  build:
    runs-on: ${{ inputs.runner }}
    permissions:
      contents: read
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4

      - name: Build Docker image
        uses: ./.github/workflows/kaniko.yaml
        with:
          registry_url: ${{ inputs.registry_url }}
          image_name: ${{ inputs.image_name }}
          dockerfile: ${{ inputs.dockerfile }}
          context: ${{ inputs.context }}
          cache: ${{ inputs.cache }}
          cache_registry: ${{ inputs.cache_registry }}
          image_push: false
          registry_username: ${{ secrets.registry_username }}
          registry_password: ${{ secrets.registry_password }}
